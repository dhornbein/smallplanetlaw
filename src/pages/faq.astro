---
import Layout from "../layouts/Layout.astro";
import Button from "../components/ui/Button.astro";
import CurvedEdge from "../components/ui/CurvedEdge.astro";
import { callToAction } from "../utils/navigation";
import { faqItems } from "../utils/faq";
import CTA from "../components/sections/CTA.astro";
import Newsletter from "../components/sections/Newsletter.astro";
import heroImg from "../assets/hero-umbrella-wide.jpg";
import heroImgTall from "../assets/hero-umbrella-tall.jpg";
import { markdown } from "@astropub/md";
---

<Layout
  title="Frequently Asked Questions | Small Planet Law"
  description="Find answers to common questions about estate planning, Life & Legacy Planning, green estate planning, and Small Planet Law's holistic approach to protecting your family and the planet."
>
  <!-- Hero Section -->
  <section
    class="bg-secondary text-primary-variant show-header relative px-8 py-24 lg:py-28"
  >
    <div class="max-w-4xl mx-auto">
      <h1>Frequently Asked Questions</h1>
      <p class="text-xl leading-relaxed max-w-prose">
        Find answers to common questions about our Life & Legacy Planning
        process, what's included, and how we can help protect what matters most
        to you.
      </p>
    </div>
  </section>

  <!-- FAQ Content -->
  <section
    class="relative bg-primary text-text-primary-inverse flex flex-col gap-8 px-4 sm:px-6 lg:px-8 pt-10 pb-30"
  >
    <CurvedEdge fillColor="fill-primary" />

    <div class="max-w-4xl mx-auto w-full">
      <div class="faq-container space-y-4">
        {
          faqItems.map(async (item) => (
            <details
              class="faq-item bg-white/10 backdrop-blur-sm rounded-lg overflow-hidden group"
              id={item.id}
            >
              <summary class="faq-question w-full text-left px-6 py-5 flex justify-between items-center gap-4 hover:bg-white/5 transition-colors cursor-pointer list-none">
                <h3 class="text-xl font-bold text-text-primary-inverse">
                  {item.question}
                </h3>
                <svg
                  class="faq-icon w-6 h-6 shrink-0 transition-transform duration-300 group-open:rotate-180"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </summary>
              <div class="faq-answer p-6">
                <div class="answer-content text-lg leading-relaxed space-y-4">
                  {await markdown(item.answer)}
                </div>
              </div>
            </details>
          ))
        }
      </div>

      <div class="text-center mt-12 pt-8 border-t border-white/20">
        <p class="text-xl mb-6">
          Ready to explore your own Life & Legacy Plan?
        </p>
        <Button
          href={callToAction.href}
          target={callToAction.target}
          variant="secondary"
          size="xl"
        >
          Book A Discovery Call
        </Button>
      </div>
    </div>
  </section>

  <CTA />
  <Newsletter />
</Layout>

<style>
  /* Hide default marker */
  summary::-webkit-details-marker,
  summary::marker {
    display: none;
  }

  .faq-question h3 {
    margin-bottom: 0;
  }

  .faq-item {
    scroll-margin-top: 10rem;
  }

  /* Basic content styling */
  .answer-content :global(ul) {
    list-style: disc;
    padding-left: 1.5rem;
  }

  .answer-content :global(a) {
    color: var(--color-white);
    text-decoration: underline;
    font-weight: 600;
  }
  .answer-content :global(a):hover {
    color: var(--color-secondary);
  }
</style>

<script>
  function initFAQ() {
    // Handle hash in URL on page load
    const hash = window.location.hash.substring(1);
    if (hash) {
      const element = document.getElementById(hash);
      if (element && element.tagName === "DETAILS") {
        (element as HTMLDetailsElement).open = true;
        setTimeout(() => {
          element.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 100);
      }
    }

    // Update URL hash and scroll when details element is toggled
    const allDetails = document.querySelectorAll("details.faq-item");

    allDetails.forEach((details) => {
      details.addEventListener("toggle", (event) => {
        const detailsEl = details as HTMLDetailsElement;

        // Only update hash and scroll when opening
        if (detailsEl.open && detailsEl.id) {
          history.pushState(
            null,
            "",
            `${window.location.pathname}#${detailsEl.id}`,
          );
          setTimeout(() => {
            detailsEl.scrollIntoView({ behavior: "smooth", block: "start" });
          }, 50);
        }
      });
    });
  }

  // Initialize on page load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initFAQ);
  } else {
    initFAQ();
  }

  // Re-initialize on Astro page transitions
  document.addEventListener("astro:page-load", initFAQ);
</script>
