---
import Button from "../ui/Button.astro";
import LogoMark from "../ui/LogoMark.astro";

const navItems = [
  { name: "Home", href: "/" },
  { name: "About Us", href: "/about" },
  { name: "Our Services", href: "/services" },
  { name: "Blog", href: "/blog" },
  { name: "Contact", href: "/contact" },
];

// element that will trigger the sticky header when scrolled past
const { triggerSelector = ".show-header" } = Astro.props;
---

<style>
  @reference "../../styles/global.css";

  header,
  header.is-top {
    @apply text-text-primary bg-transparent transition-colors duration-300;
    .logo .logo-circle,
    .logo .logo-path {
      fill: none;
      stroke: var(--color-text-primary);
    }
  }

  header.is-stuck {
    @apply bg-[#e9f1f3]/70 text-text-primary backdrop-blur-md shadow-lg;
    @apply z-50 sticky top-0 left-0 w-full transition-transform duration-300;
    .logo .logo-circle,
    .logo .logo-path {
      fill: none;
      stroke: var(--color-text-primary);
    }
  }

  header.is-stuck {
    animation: slideDown 0.3s ease-in-out;
  }

  @keyframes slideDown {
    from {
      transform: translateY(-100%);
    }
    to {
      transform: translateY(0);
    }
  }
</style>

<header
  id="main-header"
  class="h-20 relative z-50"
  data-trigger-selector={triggerSelector}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-3 group z-30">
        <LogoMark size="sm" class="logo" />
        <div class="flex flex-col">
          <span class="text-xl font-serif font-semibold">Small Planet Law</span>
          <span class="text-xs">Estate Planning â€¢ Denver, CO</span>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-8 z-50">
        {
          navItems.map((item) => (
            <a
              href={item.href}
              class="transition-colors duration-200 font-medium"
            >
              {item.name}
            </a>
          ))
        }
        <Button href="/contact" size="sm">Start Your Plan</Button>
      </nav>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-md text-neutral-warm-dark hover:text-white focus:outline-none focus:ring-2 focus:ring-white/70 z-40"
        aria-label="Toggle menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <nav
      id="mobile-menu"
      class="hidden md:hidden fixed top-0 left-0 w-full bg-stone-800 inset-shadow-lg"
    >
      <div
        class="flex flex-col justify-around h-full min-h-dvh pt-24 pb-4 px-6"
      >
        {
          navItems.map((item) => (
            <a
              href={item.href}
              class="py-2 text-neutral-warm hover:text-white transition-colors duration-200 font-medium font-serif text-2xl lowercase"
            >
              {item.name}
            </a>
          ))
        }
        <div class="pt-2">
          <Button href="/contact" size="lg" class="w-full">Get Started</Button>
        </div>
      </div>
    </nav>
  </div>
</header>

<script>
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });

  // Track when we're at the top of the viewport
  const header = document.getElementById("main-header");

  if (header) {
    const checkScrollPosition = () => {
      if (window.scrollY === 0) {
        header.classList.add("is-top");
        header.classList.remove("is-stuck");
      } else {
        header.classList.remove("is-top");
      }
    };

    // Check on scroll
    window.addEventListener("scroll", checkScrollPosition);

    // Check on page load
    checkScrollPosition();
  }

  // Sticky header on scroll past trigger element
  const triggerSelector = header?.dataset.triggerSelector;

  if (header && triggerSelector) {
    const triggerElement = document.querySelector(triggerSelector);

    if (triggerElement) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (!entry.isIntersecting) {
              // Trigger element has passed - make header sticky
              header.classList.add("is-stuck");
            }
          });
        },
        {
          threshold: 0,
          rootMargin: "0px",
        }
      );

      observer.observe(triggerElement);
    }
  }
</script>
